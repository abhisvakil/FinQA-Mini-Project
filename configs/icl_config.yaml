# In-Context Learning Configuration for FinQA

# Model Configuration
model:
  model_name_or_path: "meta-llama/Meta-Llama-3-70B-Instruct"  # Or use Qwen/Qwen2.5-72B-Instruct
  torch_dtype: "bfloat16"
  device_map: "auto"
  load_in_4bit: true  # Required for 70B models - uses ~40-48GB GPU

# Generation Parameters
generation:
  max_new_tokens: 256
  temperature: 0.1  # Low temperature for deterministic output
  top_p: 0.95
  top_k: 50
  do_sample: true
  num_beams: 1  # Greedy decoding for consistency
  repetition_penalty: 1.1

# ICL Configuration
icl:
  num_shots: 5  # Number of few-shot examples (try 3, 5, 10)
  example_selection: "diverse"  # "diverse", "random", or "similarity-based"
  
# System Prompt
system_prompt: |
  You are a financial analyst assistant. Your task is to answer numerical questions about financial reports by generating executable reasoning programs.
  
  Available Operations:
  - add(a, b): Add two numbers
  - subtract(a, b): Subtract b from a
  - multiply(a, b): Multiply two numbers
  - divide(a, b): Divide a by b
  - table(row, col): Access a table cell (0-indexed)
  - const(value): Use a constant value
  
  Guidelines:
  1. Analyze the question and context carefully
  2. Identify relevant numbers from text and tables
  3. Generate a step-by-step reasoning program
  4. Ensure the program is executable and produces the correct answer
  5. Output only the program, nothing else

# Few-shot Examples (manually curated for quality)
# These will be filled programmatically from the training set
few_shot_examples:
  - question: "What is the total revenue for 2020 and 2021?"
    context: |
      Table:
      | Year | Revenue |
      | 2020 | 1000    |
      | 2021 | 1200    |
    program: "add(const(1000), const(1200))"
    
  - question: "What is the percentage increase in revenue from 2020 to 2021?"
    context: |
      Table:
      | Year | Revenue |
      | 2020 | 1000    |
      | 2021 | 1200    |
    program: "multiply(divide(subtract(const(1200), const(1000)), const(1000)), const(100))"
    
  - question: "What is the average revenue over the two years?"
    context: |
      Table:
      | Year | Revenue |
      | 2020 | 1000    |
      | 2021 | 1200    |
    program: "divide(add(const(1000), const(1200)), const(2))"

# Prompt Template
prompt_template: |
  {system_prompt}
  
  Here are some examples:
  
  {few_shot_examples}
  
  Now answer the following:
  
  Question: {question}
  Context:
  {context}
  
  Program:

# Data Configuration
data:
  test_file: "data/test.json"
  output_file: "results/icl/predictions.json"
  max_samples: null  # For testing, can limit to e.g., 100

# Inference Settings
inference:
  batch_size: 1  # ICL typically uses batch_size=1
  use_cache: true
  save_intermediate: true  # Save intermediate results for debugging
