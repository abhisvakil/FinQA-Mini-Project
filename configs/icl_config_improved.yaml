# Improved In-Context Learning Configuration for FinQA

# Model Configuration
model:
  model_name_or_path: "mistralai/Mistral-7B-Instruct-v0.2"
  torch_dtype: "bfloat16"
  device_map: "auto"
  load_in_8bit: false

# Generation Parameters
generation:
  max_new_tokens: 256
  temperature: 0.1
  top_p: 0.95
  top_k: 50
  do_sample: true
  num_beams: 1
  repetition_penalty: 1.1

# ICL Configuration
icl:
  num_shots: 5
  example_selection: "diverse"
  
# Improved System Prompt with clearer instructions
system_prompt: |
  You are a financial reasoning expert. Generate executable programs to answer numerical questions about financial data.
  
  CRITICAL RULES:
  1. Extract exact numbers from the provided text and tables
  2. Use only these operations: add(a,b), subtract(a,b), multiply(a,b), divide(a,b), greater(a,b), exp(a,b)
  3. Use #0, #1, #2 to reference previous step results
  4. Always use actual numbers, never use placeholders like [variable] or const_X
  5. For percentages: convert to decimal or calculate as (value/total)
  6. Output ONLY the program on one line, nothing else
  
  EXAMPLES OF CORRECT FORMAT:
  - Simple: divide(121.4, 4187.8)
  - Multi-step: subtract(150, 100), divide(#0, 100)
  - Complex: subtract(318.46, 100), divide(#0, 100), subtract(206.49, 100), divide(#2, 100), subtract(#1, #3)

# Prompt Template - clearer structure
prompt_template: |
  {system_prompt}
  
  Here are examples of correct reasoning programs:
  
  {few_shot_examples}
  
  Now solve this problem:
  
  Question: {question}
  
  {context}
  
  Generate the program (one line, use exact numbers from above):
  Program:

# Data Configuration
data:
  test_file: "data/test.json"
  output_file: "results/icl_improved/predictions.json"
  max_samples: null

# Inference Settings
inference:
  batch_size: 1
  use_cache: true
  save_intermediate: true
