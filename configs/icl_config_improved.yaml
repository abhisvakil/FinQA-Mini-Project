# Improved In-Context Learning Configuration for FinQA

# Model Configuration
model:
  model_name_or_path: "mistralai/Mistral-7B-Instruct-v0.2"
  torch_dtype: "bfloat16"
  device_map: "auto"
  load_in_8bit: false

# Generation Parameters
generation:
  max_new_tokens: 256
  temperature: 0.1
  top_p: 0.95
  top_k: 50
  do_sample: true
  num_beams: 1
  repetition_penalty: 1.1

# ICL Configuration
icl:
  num_shots: 5
  example_selection: "diverse"
  
# Improved System Prompt with clearer instructions
system_prompt: |
  You are a financial reasoning expert. Generate executable programs to answer numerical questions.
  
  STRICT RULES - FOLLOW EXACTLY:
  1. ONLY use these 6 operations: add(a,b), subtract(a,b), multiply(a,b), divide(a,b), greater(a,b), exp(a,b)
  2. NO other functions allowed - no negate(), abs(), sum(), const(), etc.
  3. Use EXACT numbers from tables/text - write the numbers directly: 121.4, 4187.8, 5829, etc.
  4. NEVER write: const_X, [variable], placeholders - only real numbers
  5. For multi-step: use #0 for step 1 result, #1 for step 2, etc.
  6. Output ONLY the program - no explanations, no calculations
  
  CORRECT EXAMPLES:
  ✓ divide(121.4, 4187.8)
  ✓ subtract(5829, 5735)
  ✓ subtract(150, 100), divide(#0, 100)
  ✓ greater(286.61, 198.09)
  
  WRONG EXAMPLES (DO NOT DO THIS):
  ✗ const_121_4 or const(121.4)
  ✗ negate(5735) or abs(x)
  ✗ [variable_name]
  ✗ divide(sum(a, b), c)

# Prompt Template - clearer structure
prompt_template: |
  {system_prompt}
  
  Here are examples of correct reasoning programs:
  
  {few_shot_examples}
  
  Now solve this problem:
  
  Question: {question}
  
  {context}
  
  Generate the program (one line, use exact numbers from above):
  Program:

# Data Configuration
data:
  test_file: "data/test.json"
  output_file: "results/icl_improved/predictions.json"
  max_samples: null

# Inference Settings
inference:
  batch_size: 1
  use_cache: true
  save_intermediate: true
