# In-Context Learning Configuration for FinQA

# Model Configuration
model:
  model_name_or_path: "meta-llama/Meta-Llama-3-8B-Instruct"  # Or use mistralai/Mistral-7B-Instruct-v0.2
  torch_dtype: "bfloat16"
  device_map: "auto"
  load_in_8bit: false  # Set to true for memory-constrained environments (~8GB GPU)

# Generation Parameters
generation:
  max_new_tokens: 256
  temperature: 0.1  # Low temperature for deterministic output
  top_p: 0.95
  top_k: 50
  do_sample: true
  num_beams: 1  # Greedy decoding for consistency
  repetition_penalty: 1.1

# ICL Configuration
icl:
  num_shots: 5  # Number of few-shot examples (try 3, 5, 10)
  example_selection: "random"  # "diverse", "random", or "similarity-based"
  
# System Prompt
system_prompt: |
  You are an expert financial calculator. Your primary and most critical task is to compute the final, single numerical answer for the question. **You MUST NOT stop generating until the number is displayed.**
  
  Available Operations:
  - add(a, b): Add two numbers
  - subtract(a, b): Subtract b from a
  - multiply(a, b): Multiply two numbers
  - divide(a, b): Divide a by b
  - greater(a, b): Return the greater of two numbers (used for Yes/No questions)
  - exp(a, b): Calculate a raised to the power of b
  
  Guidelines:
  1. Analyze the question and context carefully.
  2. Generate a **complete** program using only the available operations. The program should contain all necessary nested operations to reach the final value.
  3. **After the program is complete, you must immediately compute and state the final result.**
  4. The final result must be a single numerical value, the word "Yes", or the word "No".
  5. **YOUR OUTPUT MUST ADHERE TO THIS STRICT FORMAT: 'Program: [code] ### Final Answer: [result]'**

# Few-shot Examples (manually curated for quality)
# These will be filled programmatically from the training set
few_shot_examples:
  - question: "What is the total revenue for 2020 and 2021?"
    context: |
      Table:
      | Year | Revenue |
      | 2020 | 1000    |
      | 2021 | 1200    |
    program: "add(const(1000), const(1200))"
    
  - question: "What is the percentage increase in revenue from 2020 to 2021?"
    context: |
      Table:
      | Year | Revenue |
      | 2020 | 1000    |
      | 2021 | 1200    |
    program: "multiply(divide(subtract(const(1200), const(1000)), const(1000)), const(100))"
    
  - question: "What is the average revenue over the two years?"
    context: |
      Table:
      | Year | Revenue |
      | 2020 | 1000    |
      | 2021 | 1200    |
    program: "divide(add(const(1000), const(1200)), const(2))"

# Prompt Template
prompt_template: |
  {system_prompt}
  
  Here are some examples:
  
  {few_shot_examples}
  
  Now answer the following:
  
  Question: {question}
  Context:
  {context}
  
  Program: ### Final Answer:

# Data Configuration
data:
  test_file: "src/data/simplified/test_simplified.json"
  output_file: "results/icl_config_1/predictions.json"
  max_samples: null  # For testing, can limit to e.g., 100

# Inference Settings
inference:
  batch_size: 1  # ICL typically uses batch_size=1
  use_cache: true
  save_intermediate: true  # Save intermediate results for debugging
